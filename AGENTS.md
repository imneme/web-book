# Web Book - Agent Context Guide

## Project Overview

**Web Book** is a static website generator for creating online book reading experiences. It generates clean, responsive HTML pages from Markdown or HTML content with an e-reader-like interface.

## Tech Stack

- **Backend**: Python 3.11+
- **Build Tool**: `build.py` (TOML-based configuration)
- **Frontend**: Vanilla JavaScript (no frameworks)
- **Styling**: Plain CSS with CSS custom properties
- **Content Format**: Markdown (via `markdown` package) or HTML

## Project Structure

```
/home/user/web-book/
├── build.py           # Static site generator (344 lines)
├── book.css           # Main stylesheet with mobile-responsive design
├── book.js            # Client-side JavaScript (181 lines)
├── README.md          # User documentation
├── AGENTS.md          # This file - agent context guide
├── .gitignore
└── demo/
    ├── book.toml      # Configuration file example
    └── src/chapters/  # Content files (Markdown)
```

## Key Components

### 1. Header/Navigation (Sitebar)

**Location**: Generated by `build.py` lines 91-107, styled in `book.css` lines 60-112

**HTML Structure**:
```html
<header class="sitebar">
  <div class="sitebar-inner">
    <div class="brand">
      <a href="./index.html">Book Title</a>
      <span class="brand-where">Current Chapter</span>
    </div>
    <div class="spacer"></div>
    <div class="navbtns">
      <a class="btn" href="./toc.html">TOC</a>
      <select id="font-picker">...</select>
      <button data-action="pageup">▲</button>
      <button data-action="pagedown">▼</button>
    </div>
  </div>
</header>
```

**Mobile Responsive Features** (as of 2024):
- Text truncation with ellipsis for long book titles and chapter names
- Chapter name truncates first (higher `flex-shrink` value)
- Navigation buttons never shrink (`flex-shrink: 0`)
- Two breakpoints:
  - `@media (max-width: 768px)` - Tablet/small desktop
  - `@media (max-width: 480px)` - Mobile phones
- Reduced padding, gaps, and font sizes on mobile
- Chapter name limited to 120px max-width on mobile

### 2. Build System (`build.py`)

**Key Functions**:
- `build_site(cfg_path)` - Main entry point
- `render_page(...)` - Generates individual HTML pages
- `get_ext(path)` - Detects content format (.md or .html)
- Reads `book.toml` configuration
- Outputs to `dist/` directory

**Configuration** (`book.toml`):
```toml
[book]
title = "Book Title"
description = "Description"

[[chapters]]
name = "Chapter Name"
src = "src/chapters/file.md"
```

### 3. Client-Side JavaScript (`book.js`)

**Features**:
- Table of contents state tracking
- Current position persistence (localStorage)
- Dark mode support (prefers-color-scheme)
- Font selection (serif/sans)
- Keyboard navigation (Space, PageUp/PageDown, 't' for TOC)
- Smooth scrolling for page up/down

### 4. Styling System (`book.css`)

**CSS Variables** (lines 1-18):
- `--maxw: 65ch` - Main content width
- `--fs: 18px` - Base font size
- `--lh: 1.65` - Line height
- Color scheme variables (light/dark mode)

**Dark Mode**: Automatic via `@media (prefers-color-scheme: dark)` (lines 20-32)

## Development Workflow

### Building the Site

```bash
# Install dependencies
pip install markdown

# Build from configuration
python3 build.py demo/book.toml

# Output is in dist/
cd dist && python3 -m http.server 8000
```

### Testing Mobile Layout

The header has been optimized for mobile devices with:
1. Flexbox-based responsive design
2. Text truncation with ellipsis
3. Priority system: Navigation buttons > Book title > Chapter name
4. Responsive breakpoints at 768px and 480px

## Common Modifications

### Adding New Features to Header

1. Modify `build.py` lines 91-107 for HTML structure
2. Update `book.css` for styling (start around line 60)
3. Add JavaScript handlers in `book.js` if needed

### Adjusting Mobile Breakpoints

Edit `book.css` media queries (lines 248-299):
- `@media (max-width: 768px)` - Tablet adjustments
- `@media (max-width: 480px)` - Mobile adjustments

### Adding New Color Themes

Update CSS variables in `:root` (lines 1-18) and dark mode section (lines 20-32)

## Git Workflow

- Main branch: `main` (or master)
- Feature branches: Use `claude/` prefix (e.g., `claude/fix-mobile-header-layout-4SMBC`)
- Always push with: `git push -u origin <branch-name>`

## Dependencies

**Python Packages**:
- `markdown` - For Markdown to HTML conversion (optional, only if using .md files)

**No NPM/Node.js** - Pure Python build system with vanilla JavaScript frontend

## Notes for AI Agents

- **No frameworks**: Everything is vanilla HTML/CSS/JS
- **No build complexity**: Single Python script generates static HTML
- **No bundlers**: CSS and JS are inlined in generated HTML
- **Responsive-first**: Always test mobile layouts when modifying header/navigation
- **Text overflow**: Use ellipsis truncation for long text in constrained spaces
- **Accessibility**: Maintain keyboard navigation and semantic HTML
